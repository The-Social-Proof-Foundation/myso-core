---
source: crates/myso/tests/shell_tests.rs
assertion_line: 113
---
----- script -----
#!/usr/bin/env bash
# Copyright (c) Mysten Labs, Inc.
# SPDX-License-Identifier: Apache-2.0

# We publish a legacy package that depends on another legacy package
#
# legacy_dep <-- legacy
#            <-- modern <-- legacy_depends_on_modern
#
# We have to use test-publish because you can't real-publish a legacy package on localnet

echo "=== publish legacy_dep ==="
myso client --client.config $CONFIG \
    test-publish --build-env testnet --pubfile-path Pub.local.toml legacy_dep \
    2> output.log > output.log && echo "success" || cat output.log

echo "=== publish legacy ==="
myso client --client.config $CONFIG \
    test-publish --build-env testnet --pubfile-path Pub.local.toml legacy \
    2> output.log > output.log && echo "success" || cat output.log

echo "=== publish modern ==="
myso client --client.config $CONFIG \
    test-publish --build-env testnet --pubfile-path Pub.local.toml modern \
    2> output.log > output.log && echo "success" || cat output.log

echo "=== publish legacy_depends_on_modern ==="
echo "    Should fail because legacy packages are not allowed to depend on modern packages"
myso client --client.config $CONFIG \
    test-publish --build-env testnet --pubfile-path Pub.local.toml legacy_depends_on_modern \
    2> output.log > output.log && echo "success" || cat output.log

----- results -----
success: true
exit_code: 0
----- stdout -----
=== publish legacy_dep ===
success
=== publish legacy ===
success
=== publish modern ===
Error while loading dependency /Users/brandonshaw/.move/git/https___github_com_MystenLabs_myso_git_0676e11409f87c38733863475d0819407b568a9d/crates/myso-framework/packages/myso-framework: Error while fetching `{ git = "https://...abs/myso.git", path = "crates/myso-framework/packages/myso-framework", rev = "0676e1...9d" }`: error while executing git command `Command { std: GIT_CONFIG_GLOBAL="" "git" "-c" "advice.detachedHead=false" "clone" "--quiet" "--sparse" "--filter=blob:none" "--no-checkout" "--depth" "1" "https://github.comthe-social-proof-foundation/myso-core.git" "/Users/brandonshaw/.move/git/https___github_com_MystenLabs_myso_git_0676e11409f87c38733863475d0819407b568a9d", kill_on_drop: false }`:
ErrorCode(ExitStatus(unix_wait_status(32768)))
=== publish legacy_depends_on_modern ===
    Should fail because legacy packages are not allowed to depend on modern packages
Error while loading dependency /Users/brandonshaw/.move/git/https___github_com_MystenLabs_myso_git_0676e11409f87c38733863475d0819407b568a9d/crates/myso-framework/packages/myso-framework: Error while fetching `{ git = "https://...abs/myso.git", path = "crates/myso-framework/packages/myso-framework", rev = "0676e1...9d" }`: error while executing git command `Command { std: GIT_CONFIG_GLOBAL="" "git" "-c" "advice.detachedHead=false" "clone" "--quiet" "--sparse" "--filter=blob:none" "--no-checkout" "--depth" "1" "https://github.comthe-social-proof-foundation/myso-core.git" "/Users/brandonshaw/.move/git/https___github_com_MystenLabs_myso_git_0676e11409f87c38733863475d0819407b568a9d", kill_on_drop: false }`:
ErrorCode(ExitStatus(unix_wait_status(32768)))

----- stderr -----
