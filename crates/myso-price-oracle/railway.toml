[build]
builder = "DOCKERFILE"
dockerfilePath = "crates/myso-price-oracle/Dockerfile"

[deploy]
healthcheckPath = "/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10


[environments.production.variables]
# Oracle Configuration
MYSO_ORACLE_CHAIN_ID = "8453"
MYSO_ORACLE_TOKEN_ID = "1"
MYSO_ORACLE_UPDATE_INTERVAL = "30s"
MYSO_ORACLE_PRICE_CHANGE_THRESHOLD = "0.02"

# Data Source - DripDrop API
MYSO_ORACLE_SOURCE_TYPE = "rest_api"
MYSO_ORACLE_SOURCE_URL = "https://api.testnet.dripdrop.social/price/mysocial"
MYSO_ORACLE_SOURCE_JSON_PATH = "$.priceUsd"

# Price Validation
MYSO_ORACLE_VALIDATION_MIN_PRICE_USD = "0.000001"
MYSO_ORACLE_VALIDATION_MAX_PRICE_USD = "1000000"
MYSO_ORACLE_VALIDATION_MAX_PRICE_DEVIATION_PERCENT = "50"

# Retry Configuration
MYSO_ORACLE_RETRY_MAX_ATTEMPTS = "3"
MYSO_ORACLE_RETRY_INITIAL_DELAY = "100ms"
MYSO_ORACLE_RETRY_MAX_DELAY = "30s"
MYSO_ORACLE_RETRY_MULTIPLIER = "2.0"

# Monitoring (Railway will assign PORT)
MYSO_ORACLE_MONITORING_HEALTH_CHECK_PORT = "8080"
MYSO_ORACLE_MONITORING_METRICS_PORT = "9090"

# State Persistence
MYSO_ORACLE_PERSISTENCE_DATABASE_PATH = "/app/data/oracle_state.db"

# Logging
RUST_LOG = "info,myso_price_oracle=debug"

# NOTE: These must be set as Railway secrets:
# MYSO_ORACLE_SERVER_URL - Your bridge server URL
# MYSO_ORACLE_AUTH_API_KEY - Your API key (if using API key auth)
# MYSO_ORACLE_AUTH_HMAC_SECRET - Your HMAC secret (if using HMAC auth) 